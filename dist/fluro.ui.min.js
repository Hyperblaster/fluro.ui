angular.module("fluro.ui",["fluro.config","fluro.util","youtube-embed"]),angular.module("fluro.ui").directive("fluroImage",function(){return{restrict:"EA",replace:!0,template:'<div class="fluro-image"><img ng-src="{{url}}" spinner-on-load/></div>',controller:"InlineImageController",scope:{id:"=fluroImage",imageWidth:"=",imageHeight:"="}}}).controller("InlineImageController",function($scope,Fluro){$scope.imageVars||($scope.imageVars={});var urlString=Fluro.apiURL+"/get/"+$scope.id;($scope.imageWidth||$scope.imageHeight)&&(urlString+="?dimensions",$scope.imageWidth&&(urlString+="&w="+$scope.imageWidth),$scope.imageHeight&&(urlString+="&h="+$scope.imageHeight)),$scope.url=urlString}).directive("spinnerOnLoad",function(){return{restrict:"A",link:function(scope,element){var preloader=angular.element('<span class="image-preloader"><i class="fa fa-spinner fa-spin"></i></span>');element.on("load",function(){element.removeClass("spinner-hide"),element.addClass("spinner-show"),preloader.remove()}),scope.$watch("ngSrc",function(){element.addClass("spinner-hide"),element.parent().append(preloader)})}}}),angular.module("fluro.ui").directive("fluroSlideshow",function(){return{restrict:"EA",replace:!0,templateUrl:"fluro/ui/slideshow.html",transclude:!0,require:"fluroSlideshow",controller:"FluroSlideshowController",link:function($scope,$element){$scope.$element=$element}}}).controller("FluroSlideshowController",function($scope,Playlist){var _this=this;$scope.playlist=new Playlist,$scope.next=$scope.playlist.next,$scope.previous=$scope.playlist.previous,$scope.select=$scope.playlist.select,$scope.selectIndex=function(index){$scope.playlist.index=index},$scope.$watch("playlist.currentItem",function(newSlide,oldSlide){oldSlide!=newSlide&&(oldSlide&&(oldSlide.active=!1),newSlide&&(newSlide.active=!0))}),_this.addSlide=function(slide){$scope.playlist.addItem(slide),slide==$scope.playlist.currentItem&&(slide.active=!0)},_this.removeSlide=function(slide){$scope.playlist.removeItem(slide)}}).directive("fluroSlide",function(){return{require:"^fluroSlideshow",restrict:"EA",transclude:!0,replace:!0,templateUrl:"fluro/ui/slide.html",scope:{active:"=?"},link:function(scope,element,attrs,slideshowController){slideshowController.addSlide(scope)}}}),angular.module("fluro.ui").directive("fluroVideo",function($compile,Fluro){return{restrict:"E",replace:!0,template:'<div class="fluro-video video-{{model.assetType}}"></div>',controller:"FluroVideoController",scope:{model:"=ngModel"},link:function($scope,$element){var template;switch($scope.model.assetType){case"youtube":template='<div class="video-wrapper"><youtube-video video-url="model.external.youtube" player-vars="playerVars"/></div>';break;case"vimeo":template='<div class="video-wrapper"><vimeo-video video-url="model.external.vimeo" player-vars="playerVars"/></div>';break;case"upload":$scope.playUrl=Fluro.apiURL+"/get/"+$scope.model._id,template='<div class="video-wrapper"><video controls><source ng-src="{{playUrl | trustfluro}}" type="{{model.mimetype}}"></video></div>'}if(template){var cTemplate=$compile(template)($scope);$element.append(cTemplate)}}}}).filter("trustfluro",["$sce",function($sce){return function(val){return $sce.trustAsResourceUrl(val)}}]).controller("FluroVideoController",function($scope){$scope.playerVars||($scope.playerVars={controls:0,autoplay:0,modestbranding:1,playsinline:1,showinfo:0,theme:"light",byline:0,portrait:0,title:0})}),angular.module("fluro.ui").service("VimeoEmbedSettings",function($http){var controller={};return controller.getVideoInformation=function(vimeoID){return $http.get("http://vimeo.com/api/v2/video/"+vimeoID+".output")},controller}).directive("vimeoVideo",function($compile,VimeoEmbedSettings){return{restrict:"E",scope:{videoId:"=",videoUrl:"=",playerVars:"="},link:function($scope,$element){function getVimeoID(url){var reg=/https?:\/\/(?:www\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|)(\d+)(?:$|\/|\?)/,match=url.match(reg);return match?match[3]:void 0}$scope.getVideoInformation=function(){return $scope.videoId?VimeoEmbedSettings.getVideoInformation($scope.videoId):void 0},$scope.$watch("videoId + videoUrl + playerVars",function(){var VideoID;$scope.videoId?VideoID=$scope.videoId:$scope.videoUrl&&(VideoID=getVimeoID($scope.videoUrl));var params="";if($scope.playerVars)for(var key in $scope.playerVars)params+="&"+key+"="+$scope.playerVars[key];$scope.vimeoEmbedURL="//player.vimeo.com/video/"+VideoID+"?player_id="+VideoID+params});var template='<iframe ng-src="{{vimeoEmbedURL | trustVimeo}}" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',cTemplate=$compile(template)($scope);$element.replaceWith(cTemplate)}}}).filter("trustVimeo",["$sce",function($sce){return function(val){return $sce.trustAsResourceUrl(val)}}]),angular.module("fluro.ui").directive("fluroGallery",function(){return{restrict:"E",replace:!0,templateUrl:"fluro/ui/gallery.html",scope:{model:"=ngModel"},controller:"FluroGalleryController",link:function($scope,$element){$scope.$element=$element}}}).controller("FluroGalleryController",function($scope,Playlist){$scope.playlist=new Playlist,$scope.playlist.items=$scope.model,$scope.isActive=function(image){return $scope.playlist.currentItem==image},$scope.next=$scope.playlist.next,$scope.previous=$scope.playlist.previous,$scope.select=$scope.playlist.select,$scope.selectIndex=function(index){$scope.playlist.index=index}}),angular.module("fluro.ui").directive("fluroNotifications",function(){return{restrict:"EA",transclude:!0,replace:!0,controller:"FluroNotificationsController",template:'<div class="notifications"><div class="notification animate {{message.type}}" ng-repeat="message in messages"><i class="fa fa-{{message.type}}"></i><span>{{message.text}}</span><i class="close fa fa-times" ng-click="message.remove()"></i></div></div>'}}).controller("FluroNotificationsController",function($scope,Notifications){$scope.messages=Notifications.list}).service("Notifications",function($timeout){var controller={list:[]};return controller.warning=function(text,delay){controller.post(text,"warning",delay)},controller.error=function(text,delay){controller.post(text,"error",delay)},controller.status=function(text,delay){controller.post(text,"status",delay)},controller.post=function(text,type,delay){"undefined"==typeof type&&(type="status"),"undefined"==typeof delay&&(delay=5e3);var msg={};msg.text=text,msg.type=type,msg.remove=function(){var i=controller.list.indexOf(msg);-1!=i&&controller.list.splice(i,1)},controller.list.push(msg),$timeout(msg.remove,delay)},controller}),angular.module("fluro.ui").directive("slider",function(){return{restrict:"EA",transclude:!0,replace:!0,template:'<div class="slider"><div class="slider-contents" ng-transclude></div></div>'}}),function(){Date.shortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Date.longMonths=["January","February","March","April","May","June","July","August","September","October","November","December"],Date.shortDays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Date.longDays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var replaceChars={d:function(){return(this.getDate()<10?"0":"")+this.getDate()},D:function(){return Date.shortDays[this.getDay()]},j:function(){return this.getDate()},l:function(){return Date.longDays[this.getDay()]},N:function(){return 0==this.getDay()?7:this.getDay()},S:function(){return this.getDate()%10==1&&11!=this.getDate()?"st":this.getDate()%10==2&&12!=this.getDate()?"nd":this.getDate()%10==3&&13!=this.getDate()?"rd":"th"},w:function(){return this.getDay()},z:function(){var d=new Date(this.getFullYear(),0,1);return Math.ceil((this-d)/864e5)},W:function(){var target=new Date(this.valueOf()),dayNr=(this.getDay()+6)%7;target.setDate(target.getDate()-dayNr+3);var firstThursday=target.valueOf();return target.setMonth(0,1),4!==target.getDay()&&target.setMonth(0,1+(4-target.getDay()+7)%7),1+Math.ceil((firstThursday-target)/6048e5)},F:function(){return Date.longMonths[this.getMonth()]},m:function(){return(this.getMonth()<9?"0":"")+(this.getMonth()+1)},M:function(){return Date.shortMonths[this.getMonth()]},n:function(){return this.getMonth()+1},t:function(){var d=new Date;return new Date(d.getFullYear(),d.getMonth(),0).getDate()},L:function(){var year=this.getFullYear();return year%400==0||year%100!=0&&year%4==0},o:function(){var d=new Date(this.valueOf());return d.setDate(d.getDate()-(this.getDay()+6)%7+3),d.getFullYear()},Y:function(){return this.getFullYear()},y:function(){return(""+this.getFullYear()).substr(2)},a:function(){return this.getHours()<12?"am":"pm"},A:function(){return this.getHours()<12?"AM":"PM"},B:function(){return Math.floor(1e3*((this.getUTCHours()+1)%24+this.getUTCMinutes()/60+this.getUTCSeconds()/3600)/24)},g:function(){return this.getHours()%12||12},G:function(){return this.getHours()},h:function(){return((this.getHours()%12||12)<10?"0":"")+(this.getHours()%12||12)},H:function(){return(this.getHours()<10?"0":"")+this.getHours()},i:function(){return(this.getMinutes()<10?"0":"")+this.getMinutes()},s:function(){return(this.getSeconds()<10?"0":"")+this.getSeconds()},u:function(){var m=this.getMilliseconds();return(10>m?"00":100>m?"0":"")+m},e:function(){return"Not Yet Supported"},I:function(){for(var DST=null,i=0;12>i;++i){var d=new Date(this.getFullYear(),i,1),offset=d.getTimezoneOffset();if(null===DST)DST=offset;else{if(DST>offset){DST=offset;break}if(offset>DST)break}}return this.getTimezoneOffset()==DST|0},O:function(){return(-this.getTimezoneOffset()<0?"-":"+")+(Math.abs(this.getTimezoneOffset()/60)<10?"0":"")+Math.abs(this.getTimezoneOffset()/60)+"00"},P:function(){return(-this.getTimezoneOffset()<0?"-":"+")+(Math.abs(this.getTimezoneOffset()/60)<10?"0":"")+Math.abs(this.getTimezoneOffset()/60)+":00"},T:function(){return this.toTimeString().replace(/^.+ \(?([^\)]+)\)?$/,"$1")},Z:function(){return 60*-this.getTimezoneOffset()},c:function(){return this.format("Y-m-d\\TH:i:sP")},r:function(){return this.toString()},U:function(){return this.getTime()/1e3}};Date.prototype.format=function(format){var date=this;return format.replace(/(\\?)(.)/g,function(_,esc,chr){return""===esc&&replaceChars[chr]?replaceChars[chr].call(date):chr})}}.call(this),angular.module("fluro.ui").filter("formatDate",function(){return function(dateString,format){return new Date(dateString).format(format)}}),angular.module("fluro.ui").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("fluro/ui/columns.html",'<div class=columns><div class="outer cf"><div class=wrapper><div class=column-{{columnWidth}} ng-repeat="item in model"><render ng-model=item></render></div></div></div></div>'),$templateCache.put("fluro/ui/countdown.html",""),$templateCache.put("fluro/ui/gallery.html",'<div class=gallery><div class=outer><div class=wrapper><div class=slideshow ng-swipe-right=previous() ng-swipe-left=next()><div class=slideshow-contents><div class="gallery-slide slide animated" ng-class={active:isActive(image)} ng-repeat="image in model"><img fluro-image=image._id alt={{image.title}} image-height="1200"></div></div><div class=slideshow-controls ng-if="playlist.length > 1"><div class=slideshow-controls-wrapper><a class="slideshow-control slideshow-previous" ng-click=previous()><i class="fa fa-chevron-left"></i></a> <a class="slideshow-control slideshow-next" ng-click=next()><i class="fa fa-chevron-right"></i></a></div></div><div class=slideshow-nav ng-if="playlist.length > 1"><a ng-click=select(item) ng-repeat="item in playlist.items" ng-class={active:isActive(item)}><i class=fa ng-class="{\'fa-circle-o\':!isActive(item), \'fa-circle\':isActive(item)}"></i></a></div></div><div class=gallery-thumbs><slider><div class=gallery-thumb ng-class={active:isActive(image)} ng-click=playlist.select(image) ng-repeat="image in model"><img fluro-image=image._id alt={{image.title}} image-height="150"></div></slider></div></div></div></div>'),$templateCache.put("fluro/ui/slide.html",'<div class="slide animated" ng-class="{\'active\':active}" ng-transclude></div>'),$templateCache.put("fluro/ui/slideshow.html",'<div class=slideshow ng-swipe-right=previous() ng-swipe-left=next()><div class=slideshow-contents ng-transclude></div><div class=slideshow-controls ng-if="playlist.length > 1"><div class=slideshow-controls-wrapper><a class="slideshow-control slideshow-previous" ng-click=previous()><i class="fa fa-chevron-left"></i></a> <a class="slideshow-control slideshow-next" ng-click=next()><i class="fa fa-chevron-right"></i></a></div></div><div class=slideshow-nav ng-if="playlist.length > 1"><a ng-click=select(item) ng-repeat="item in playlist.items" ng-class={active:item.active}><i class=fa ng-class="{\'fa-circle-o\':!item.active, \'fa-circle\':item.active}"></i></a></div></div>')}]);